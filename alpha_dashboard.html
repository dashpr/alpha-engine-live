<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Institutional Alpha Engine Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body { font-family: "Inter", Arial, sans-serif; margin: 0; background: #020617; color: #e2e8f0; }
    header { background: #020617; padding: 22px 30px; font-size: 24px; font-weight: 600; border-bottom: 1px solid #1e293b; }
    .container { padding: 30px; max-width: 1400px; margin: auto; }
    .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 16px; margin-bottom: 24px; }
    .card { background: #020617; padding: 18px; border-radius: 16px; border: 1px solid #1e293b; }
    .title { font-size: 12px; color: #94a3b8; margin-bottom: 6px; text-transform: uppercase; }
    .value { font-size: 24px; font-weight: 600; }
    table { width: 100%; border-collapse: collapse; margin-top: 16px; border: 1px solid #1e293b; }
    th, td { padding: 12px; border-bottom: 1px solid #1e293b; text-align: left; font-size: 14px; }
    th { color: #94a3b8; }
    tr:hover { background: rgba(255,255,255,0.03); }
    .signal-buy { color: #22c55e; font-weight: 600; }
    .signal-wait { color: #facc15; font-weight: 600; }
    .signal-trim { color: #ef4444; font-weight: 600; }
    .signal-hold { color: #38bdf8; font-weight: 600; }
    .star { cursor: pointer; margin-left: 6px; color: #94a3b8; font-size: 16px; }
    .explain { display: none; font-size: 13px; color: #cbd5f5; margin-top: 6px; line-height: 1.5; }
    canvas { background: #020617; border-radius: 16px; border: 1px solid #1e293b; padding: 12px; margin-top: 10px; }
    footer { text-align: center; padding: 24px; color: #64748b; font-size: 13px; border-top: 1px solid #1e293b; margin-top: 40px; }
  </style>
</head>
<body>

<header>Institutional AI Alpha Engine · Live Dashboard</header>

<div class="container">

  <div class="grid">
    <div class="card"><div class="title">Market Regime</div><div class="value" id="regime">—</div></div>
    <div class="card"><div class="title">Last Rebalance</div><div class="value" id="lastRebalance">—</div></div>
    <div class="card"><div class="title">Next Rebalance</div><div class="value" id="nextRebalance">—</div></div>
  </div>

  <canvas id="equityChart" height="110"></canvas>

  <h2 style="margin-top:40px;">Top-15 Portfolio · Quant Attribution</h2>
  <table>
    <thead>
      <tr>
        <th>Stock</th>
        <th>Weight</th>
        <th>Signal</th>
        <th>Confidence</th>
        <th>Explainability</th>
      </tr>
    </thead>
    <tbody id="portfolioTable"></tbody>
  </table>

  <h2 style="margin-top:40px;">AI Market Commentary (Hourly)</h2>
  <div class="card" id="commentary">Loading AI narrative...</div>

</div>

<footer>© Pravash Dash · 2026 · Institutional AI Alpha Engine</footer>

<script>

// ✅ FIXED URLs (same-domain GitHub Pages → no CORS issue)
const DATA_URL = "https://dashpr.github.io/alpha-engine-live/output/dashboard_data.json";
const COMMENTARY_URL = "https://dashpr.github.io/alpha-engine-live/output/market_commentary.json";

function confidenceScore(signal) {
  if (signal === "BUY NOW") return "High";
  if (signal === "WAIT") return "Medium";
  if (signal === "TRIM") return "Low";
  return "Stable";
}

function buildExplainability(signal) {
  return `
    Momentum Rank: Strong relative percentile.<br>
    Trend Alignment: Above medium-term moving averages.<br>
    Volatility State: Within institutional tolerance band.<br>
    Regime Fit: Compatible with current market regime.<br>
    Action Logic: ${signal} derived from blended factor model.
  `;
}

async function loadDashboard() {
  try {
    const res = await fetch(DATA_URL);
    const data = await res.json();

    document.getElementById("regime").textContent = data.regime;
    document.getElementById("lastRebalance").textContent = data.last_rebalance;
    document.getElementById("nextRebalance").textContent = data.next_rebalance;

    const ctx = document.getElementById("equityChart");
    new Chart(ctx, {
      type: "line",
      data: {
        labels: data.equity_dates,
        datasets: [
          { label: "Model Equity", data: data.equity_values, borderWidth: 2, tension: 0.25 },
          { label: "NIFTY", data: data.nifty_values, borderWidth: 2, tension: 0.25 }
        ]
      },
      options: {
        plugins: { legend: { labels: { color: "#e2e8f0" } } },
        scales: { x: { ticks: { color: "#94a3b8" } }, y: { ticks: { color: "#94a3b8" } } }
      }
    });

    const tbody = document.getElementById("portfolioTable");

    data.holdings.forEach((h, i) => {
      const signal = data.trades[i] ? data.trades[i].signal : "HOLD";
      const confidence = confidenceScore(signal);
      const explain = buildExplainability(signal);

      const row = document.createElement("tr");
      row.innerHTML = `
        <td>${h.ticker}</td>
        <td>${h.weight}%</td>
        <td class="signal-${signal.toLowerCase().replace(' ', '')}">${signal}</td>
        <td>${confidence}</td>
        <td>
          <span class="star" onclick="toggleExplain(${i})">★</span>
          <div class="explain" id="exp-${i}">${explain}</div>
        </td>
      `;

      tbody.appendChild(row);
    });

  } catch (err) {
    console.error("Dashboard load failed", err);
  }
}

async function loadCommentary() {
  try {
    const res = await fetch(COMMENTARY_URL);
    const c = await res.json();

    document.getElementById("commentary").innerHTML = `
      <b>Sentiment:</b> ${c.sentiment}<br><br>
      <b>AI Summary:</b> ${c.summary}<br><br>
      <b>Latest Headlines:</b>
      <ul>${c.headlines.map(h => `<li>${h}</li>`).join("")}</ul>
      <div style="margin-top:10px;font-size:12px;color:#64748b;">
        Updated: ${new Date(c.timestamp).toLocaleString()}
      </div>
    `;
  } catch (err) {
    document.getElementById("commentary").textContent = "AI commentary temporarily unavailable.";
  }
}

function toggleExplain(i) {
  const el = document.getElementById(`exp-${i}`);
  el.style.display = el.style.display === "block" ? "none" : "block";
}

loadDashboard();
loadCommentary();

</script>

</body>
</html>
