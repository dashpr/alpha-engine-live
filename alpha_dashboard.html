<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>AI Alpha Engine ‚Äî Investor Dashboard</title>

<style>
body{
  margin:0;
  font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial;
  background:#071b2b;
  color:#e6f0ff;
}
.container{
  max-width:1200px;
  margin:auto;
  padding:24px;
}
h1{margin-bottom:6px;}
.grid{
  display:grid;
  grid-template-columns:2fr 1fr;
  gap:20px;
}
.card{
  background:#0c2a3d;
  padding:18px;
  border-radius:14px;
}
.smallgrid{
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:20px;
  margin-top:20px;
}
table{
  width:100%;
  border-collapse:collapse;
}
td,th{
  padding:8px;
  border-bottom:1px solid #1f455e;
  text-align:left;
}
.green{color:#2ecc71;}
.red{color:#ff6b6b;}
.timestamp{
  opacity:.7;
  font-size:13px;
  margin-top:6px;
}
</style>
</head>

<body>
<div class="container">

<h1>AI Alpha Engine ‚Äî Investor Dashboard</h1>
<div class="timestamp" id="updated">Loading timestamp‚Ä¶</div>

<div class="grid">

  <!-- NAV -->
  <div class="card">
    <h2>NAV (since inception)</h2>
    <h1 id="navValue">Loading‚Ä¶</h1>
    <div id="navReturn"></div>
  </div>

  <!-- Right metrics -->
  <div class="card">
    <h3>AUM</h3>
    <div id="aum">‚Äî</div>
    <h3 style="margin-top:14px;">Regime</h3>
    <div id="regime">‚Äî</div>
    <div id="regimeNote" class="timestamp"></div>
  </div>

</div>

<!-- Snapshot + Risk -->
<div class="smallgrid">

  <div class="card">
    <h3>Portfolio Snapshot</h3>
    <table id="snapshotTable"></table>
  </div>

  <div class="card">
    <h3>Risk Metrics</h3>
    <div id="risk"></div>
  </div>

</div>

<!-- Positions -->
<div class="card" style="margin-top:20px;">
  <h3>Portfolio Positions</h3>
  <table id="positionsTable"></table>
</div>

<!-- Events -->
<div class="card" style="margin-top:20px;">
  <h3>Event Intelligence</h3>
  <ul id="events"></ul>
</div>

<!-- AI Commentary -->
<div class="card" style="margin-top:20px;">
  <h3>AI Portfolio Commentary</h3>
  <div id="ai"></div>
</div>

</div>

<script>
const base = "phase2/data/";

async function loadJSON(file){
  const r = await fetch(base + file + "?t=" + Date.now());
  if(!r.ok) throw new Error(file + " not found");
  return await r.json();
}

async function init(){

  try{

    const nav = await loadJSON("nav.json");
    const governance = await loadJSON("governance.json");
    const snapshot = await loadJSON("portfolio_state.json");
    const positions = await loadJSON("positions.json");
    const risk = await loadJSON("risk.json");
    const events = await loadJSON("events.json");
    const ai = await loadJSON("ai_commentary.json");

    // NAV
    document.getElementById("navValue").innerText =
      "‚Çπ" + nav.value.toLocaleString();

    const r = nav.return_pct.toFixed(2) + "%";
    document.getElementById("navReturn").innerHTML =
      `<span class="${nav.return_pct>=0?'green':'red'}">${r}</span>`;

    // AUM + regime
    document.getElementById("aum").innerText =
      "‚Çπ" + nav.capital.toLocaleString();

    document.getElementById("regime").innerText = governance.regime;
    document.getElementById("regimeNote").innerText = governance.regime_note;

    document.getElementById("updated").innerText =
      "Updated: " + governance.timestamp_ist;

    // Snapshot
    const snapTable = document.getElementById("snapshotTable");
    snapTable.innerHTML =
      "<tr><th>Symbol</th><th>Weight</th></tr>" +
      snapshot.holdings.map(h =>
        `<tr><td>${h.symbol}</td><td>${h.weight}%</td></tr>`
      ).join("");

    // Positions
    const posTable = document.getElementById("positionsTable");
    posTable.innerHTML =
      "<tr><th>Symbol</th><th>Qty</th><th>Avg</th><th>Price</th><th>MTM</th></tr>" +
      positions.positions.map(p =>
        `<tr>
          <td>${p.symbol}</td>
          <td>${p.qty}</td>
          <td>${p.avg_cost}</td>
          <td>${p.price}</td>
          <td>${p.mtm}</td>
        </tr>`
      ).join("");

    // Risk
    document.getElementById("risk").innerText =
      `CAGR: ${risk.cagr}% | Max DD: ${risk.max_dd}% | Sharpe: ${risk.sharpe}`;

    // Events
    document.getElementById("events").innerHTML =
      events.events.map(e => `<li>${e}</li>`).join("");

    // AI commentary
    document.getElementById("ai").innerText = ai.commentary;

  }catch(err){
    console.error(err);
  }
}

init();

// üîÅ Auto refresh every 15 min
setInterval(init, 900000);
</script>

</body>
</html>
